<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>ЁЯОп Adson App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f4f4f4;
      text-align: center;
      padding: 20px;
    }
    .box {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 400px;
      margin: auto;
    }
    .btn {
      padding: 12px 20px;
      margin-top: 10px;
      background-color: #2AABEE;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    .small {
      font-size: 14px;
      margin-top: 5px;
      color: gray;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>ЁЯОп Adson App</h2>
    <p>ЁЯзо ржЖржкржирж╛рж░ ржкржпрж╝рзЗржирзНржЯ: <span id="pointValue">0</span></p>
    <button class="btn" onclick="watchAd()">ЁЯОе ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи</button>
    <p class="small" id="timerMessage"></p>
    <button class="btn" onclick="claimPoint()">ЁЯТ░ ржкржпрж╝рзЗржирзНржЯ рж╕ржВржЧрзНрж░рж╣ ржХрж░рзБржи</button>
    <button class="btn" onclick="redeem()">ЁЯТ╕ ржХрзНржпрж╛рж╢ржЖржЙржЯ</button>
    <button class="btn" onclick="showReferral()">ЁЯОБ рж░рзЗржлрж╛рж░рзЗрж▓ рж▓рж┐ржВржХ</button>
  </div>

  <!-- Monetag/Ad Script -->
  <script src='//libtl.com/sdk.js' data-zone='9417101' data-sdk='show_9417101'></script>

  <script>
    const userId = Telegram.WebApp.initDataUnsafe?.user?.id || Math.floor(Math.random() * 1000000);
    const referralCode = `ref${userId}`;
    const adCountKey = "adCount";
    const lastAdTimeKey = "lastAdTime";
    const pointKey = "adPoints";
    let adWatched = false;

    const refBy = new URLSearchParams(window.location.search).get("ref");
    if (refBy && !localStorage.getItem("referred")) {
      localStorage.setItem("referred", refBy);
      // sendReferral(refBy); // Google Sheet integration placeholder
    }

    let points = parseInt(localStorage.getItem(pointKey)) || 0;
    let adCount = parseInt(localStorage.getItem(adCountKey)) || 0;
    document.getElementById("pointValue").innerText = points;

    function watchAd() {
      const lastTime = parseInt(localStorage.getItem(lastAdTimeKey)) || 0;
      const now = Date.now();
      if (adCount >= 15 && now - lastTime < 10 * 60 * 1000) {
        const mins = Math.ceil((10 * 60 * 1000 - (now - lastTime)) / 60000);
        document.getElementById("timerMessage").innerText = `тП│ ${mins} ржорж┐ржирж┐ржЯ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи`;
        return;
      }

      if (adCount >= 15) {
        adCount = 0;
        localStorage.setItem(adCountKey, 0);
        localStorage.setItem(lastAdTimeKey, now);
      }

      alert("ЁЯОе ржмрж┐ржЬрзНржЮрж╛ржкржи ржЪрж▓ржЫрзЗ...");
      adWatched = true;
    }

    function claimPoint() {
      if (adWatched) {
        points += 10;
        adCount += 1;
        adWatched = false;
        localStorage.setItem(pointKey, points);
        localStorage.setItem(adCountKey, adCount);
        document.getElementById("pointValue").innerText = points;
        document.getElementById("timerMessage").innerText = `тЬЕ ржкржпрж╝рзЗржирзНржЯ ржЕрзНржпрж╛ржб рж╣ржпрж╝рзЗржЫрзЗ! (${adCount}/15 ржжрзЗржЦрж╛ рж╣ржпрж╝рзЗржЫрзЗ)`;
      } else {
        alert("тЪая╕П ржЖржЧрзЗ ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи рждрж╛рж░ржкрж░ ржкржпрж╝рзЗржирзНржЯ рж╕ржВржЧрзНрж░рж╣ ржХрж░рзБржи!");
      }
    }

    function redeem() {
      if (points >= 100) {
        const phone = prompt("ЁЯУ▒ ржмрж┐ржХрж╛рж╢/ржиржЧржж ржиржорзНржмрж░ рж▓рж┐ржЦрзБржи:");
        if (phone && phone.length >= 10) {
          alert("тЬЕ ржХрзНржпрж╛рж╢ржЖржЙржЯ ржЕржирзБрж░рзЛржз ржкрж╛ржарж╛ржирзЛ рж╣ржпрж╝рзЗржЫрзЗ!");
          points = 0;
          localStorage.setItem(pointKey, 0);
          document.getElementById("pointValue").innerText = points;
          // sendToSheet(userId, phone); // placeholder for Google Sheet
        } else {
          alert("тЭМ рж╕ржарж┐ржХ ржирж╛ржорзНржмрж╛рж░ ржжрж┐ржи!");
        }
      } else {
        alert("тЭМ ржХржоржкржХрзНрж╖рзЗ рззрзжрзж ржкржпрж╝рзЗржирзНржЯ рж▓рж╛ржЧржмрзЗ ржХрзНржпрж╛рж╢ржЖржЙржЯрзЗрж░ ржЬржирзНржп");
      }
    }

    function showReferral() {
      const link = `${window.location.origin}?ref=${referralCode}`;
      prompt("ЁЯОБ ржЖржкржирж╛рж░ рж░рзЗржлрж╛рж░рзЗрж▓ рж▓рж┐ржВржХ:", link);
    }
  </script>
</body>
</html>
